# pa4：中间代码优化

pa4中我们将进行一定程度的基于数据流分析的中间代码优化。与java版本的实验(计算du-chain并打印，然而后续实验没有用到)不同，这里的数据流分析的目的不只是为了输出一个结果，而是用分析的结果进行一定的优化。

框架中已经提供了三种优化的实现，即公共表达式提取，常量传播，复写传播，还有一项死代码消除没有实现，这是大家的实验任务。需要说明的是，目前我们只在很有限的测例上检测了优化的正确性，而且这个框架是第一次使用，所以有可能在已经实现的优化中存在bug，大家如果发现bug希望能及时汇报。

为了避免大家没有掌握java版本实验中du-chain计算的相关知识点，我们仍然要求在报告中说明du-chain的计算方式。在课程的课件中有提到一个算法，即将各个集合的元素都从变量扩展成`(变量，语句标号)`的二元组，然后用相似的算法框架来迭代求解。请以伪代码的方式说明这个算法，注意需要具体说明这几个集合在每个迭代步中是怎样运算的。

我们默认的检查答案方式是直接对比tac的输出结果，但是也许输出的tac会因算法的细节不同而略有差异(尽管我个人并不太相信)，所以假如测试结果为`Fail`，仍然可以在`pa4/out`文件夹下查看与decaf代码同名的`xxx.info`文件，这里输出了tacvm终止前执行的指令的条数，只要它小于等于`pa4/ans`中对应的条数，你的实现仍然会被认为是正确的。

值得注意的是，对于tac语句`_Tx = call F`，tacvm在运行前会先将它拆分成两条指令；其余语句，包括`call F`，在tacvm中都对应于一条指令。
